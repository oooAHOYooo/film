<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Full Script - Machulu Script</title>
  <link rel="stylesheet" href="/pages/summer/script-system/script.css?v=20260108-5">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="gallery-container">
    <div class="script-sticky-bar no-print" id="scriptStickyBar">
      <div class="nav">
        <div class="nav-left">
          <a href="/pages/winter.html">← Winter Hub</a>
          <a href="/pages/winter.html">← Back to Gallery</a>
        </div>
        <button type="button" class="print-button" onclick="window.print()">Print</button>
      </div>

      <div class="script-stats-row">
        <div class="script-status-bar" id="scriptStatusBar" aria-hidden="true">
          <div class="script-status-scene-block">
            <span class="script-status-scene" id="scriptStatusScene">—</span>
            <span class="script-status-characters" id="scriptStatusCharacters">—</span>
          </div>
          <span class="script-status-divider">|</span>
          <span class="script-status-production" id="scriptStatusProduction">—</span>
        </div>
        <div class="script-scene-nav">
          <label for="scriptSceneSelect" class="script-scene-nav-label">Jump to scene</label>
          <select id="scriptSceneSelect" class="script-scene-select" aria-label="Jump to scene">
            <option value="">—</option>
            <option value="scene-1">1. Arrival</option><option value="scene-2">2. The Flower</option><option value="scene-3">3. Thick Wood</option><option value="scene-4">4. The Pole</option><option value="scene-5">5. Approaching the Outpost</option><option value="scene-6">6. YoHanse Touches</option><option value="scene-7">7. Henri Nods</option><option value="scene-8">8. Why We Are Here</option><option value="scene-9">9. Can You Guess?</option><option value="scene-10">10. Climb to See</option><option value="scene-11">11. Henri Gives In</option><option value="scene-12">12. Professor's Eyes</option><option value="scene-13">13. We Are Here to Learn</option><option value="scene-14">14. Fly</option><option value="scene-15">15. Says Who?</option><option value="scene-16">16. Only You</option><option value="scene-17">17. Fly for Flying's Sake</option><option value="scene-18">18. Head to the Castle</option><option value="scene-19">19. Beneath the Pole</option><option value="scene-20">20. The Attempt</option><option value="scene-21">21. Moments Pass</option><option value="scene-22">22. Toward the Thicket</option><option value="scene-23">23. Yaka!</option><option value="scene-24">24. Twenty Five Down</option><option value="scene-25">25. Under the Cloak</option><option value="scene-26">26. YoHanse Peers</option><option value="scene-27">27. Dust Spirals</option><option value="scene-28">28. Amber Eyes</option><option value="scene-29">29. Do You Know Who We Are?</option><option value="scene-30">30. The Waterfall</option>
          </select>
        </div>
      </div>
      <div class="script-progress" id="scriptProgress" aria-hidden="true">
        <div class="script-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
          <div class="script-progress-fill" id="scriptProgressFill"></div>
        </div>
        <div class="script-progress-label" id="scriptProgressLabel">Minute 0</div>
      </div>
    </div>

    <div class="screenplay-container">
      <div class="full-script-header">
        <div class="full-script-title">Machulu Script — Full Script</div>
        <div class="full-script-meta">Compiled on 1/30/2026, 11:43:31 AM</div>
      </div>
      <div class="screenplay-content" id="scriptContent"></div>
    </div>
  </div>

  <script>
    const markdown = "# Machulu Script — Full Script\n\n*Compiled on 1/30/2026, 11:43:31 AM*\n\n---\n\n\n## ACT I — Into the Wood\n\n---\n\n\n### Scene 1: Arrival\n\n*ACT I — Into the Wood | ID: arrival | File: 01_arrival.md*\n\n---\n\nEXT. THE WOOD — DAY\n\nHENRI moves through a world that is not his own. The PROFESSOR and YOHANSE walk ahead. Fog hangs in the trees. Everything looks as if it were reflecting out of bubbles.\n\nHenri follows. From this point, he feels along for the ride.\n\n\n---\n\n\n### Scene 2: The Flower\n\n*ACT I — Into the Wood | ID: the-flower | File: 02_the_flower.md*\n\n---\n\nEXT. THE WOOD — DAY (FLASHBACK / REFERENCE)\n\nYoHanse discovers the flower—from the previous entry. A moment of wonder before the journey to the outpost.\n\nThe party presses on.\n\n\n---\n\n\n### Scene 3: Thick Wood\n\n*ACT I — Into the Wood | ID: thick-wood | File: 03_thick_wood.md*\n\n---\n\nEXT. THICK WOOD — DAY\n\nThe party walks through the thick wood. Fog makes everything look as if it were reflecting out of bubbles.\n\nOut of the wood, something stands ahead: a tiny, what appears to be, wooden pole.\n\n\n---\n\n\n### Scene 4: The Pole\n\n*ACT I — Into the Wood | ID: the-pole | File: 04_the_pole.md*\n\n---\n\nEXT. CLEARING — DAY\n\nAs they walk closer, the top of the wooden pole begins to become clear.\n\nOne could notice—something at the top. Long, curved shafts of wood, wrapped like twine hoping to break out of its mold. It reminds Henri of what a tiki torch would look like.\n\nAn outpost.\n\n\n---\n\n\n### Scene 5: Approaching the Outpost\n\n*ACT I — Into the Wood | ID: approaching-outpost | File: 05_approaching_outpost.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nThey approach the structure. The top is now clear—an outpost, tiki-torch-like. Long, curved shafts of wood, wrapped like twine.\n\nYoHanse runs up to it and begins to touch. The Professor soon follows. The party turns to Henri.\n\n\n---\n\n\n### Scene 6: YoHanse Touches\n\n*ACT I — Into the Wood | ID: yohanse-touches | File: 06_yohanse_touches.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nYoHanse runs to the structure and touches it. The Professor follows. Both look at Henri.\n\nHenri doesn't know how to react. Not much could surprise him anymore.\n\n\n---\n\n\n### Scene 7: Henri Nods\n\n*ACT I — Into the Wood | ID: henri-nods | File: 07_henri_nods.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHenri nods his head. From this point he feels along for the ride—there wouldn't be much that could surprise him.\n\nThe Professor watches him. YoHanse smiles.\n\n\n---\n\n\n### Scene 8: Why We Are Here\n\n*ACT I — Into the Wood | ID: why-we-are-here | File: 08_why_we_are_here.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nPROFESSOR\n\nAye Henri, do you know why we are here?\n\nHENRI\n\nNo.\n\nPROFESSOR\n\nCan you guess?\n\nHenri looks up at the structure, at the post, follows the post up to the top tiki-torch lookout. He really doesn't know the answer. He has long given up on attempting to humor them with wit.\n\n\n---\n\n\n### Scene 9: Can You Guess?\n\n*ACT I — Into the Wood | ID: can-you-guess | File: 09_can_you_guess.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nI really don't know.\n\nPROFESSOR\n\nWhat harm is there in guessing? Give it a guess.\n\nYoHanse turns around. Both are eagerly awaiting a response.\n\n\n---\n\n\n### Scene 10: Climb to See\n\n*ACT I — Into the Wood | ID: climb-to-see | File: 10_climb_to_see.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nPerhaps you want to climb up there to get a better sense of where we are?\n\nPROFESSOR\n\nHow would climbing up there get a better sense?\n\nThe Professor smirks. Henri is tired of these games of withholding information. But he is thirsty, hot, tired—yearning rest. He gives in.\n\n\n---\n\n\n## ACT II — The Outpost\n\n---\n\n\n### Scene 11: Henri Gives In\n\n*ACT II — The Outpost | ID: henri-gives-in | File: 11_henri_gives_in.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nWell, if we were to see this wood from higher ground—we could better understand where we are in relation to the greater country. Perhaps we will see a path we haven't before on the ground. Perhaps we will find a way out of here.\n\nThe Professor's eyes gleam.\n\nPROFESSOR\n\nAnd if we were to find such a way out of here. Where would we go?\n\nHENRI\n\nI am assuming we'll go back to the kingdom that YoHanse is trying to find.\n\nYoHanse smiles—though he doesn't understand Henri, he is excited to hear his name.\n\n\n---\n\n\n### Scene 12: Professor's Eyes\n\n*ACT II — The Outpost | ID: professors-eyes | File: 12_professors_eyes.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nPROFESSOR\n\nThat's a good guess dear Henri. I like the way your mind navigates new information. Fresh, innocent, unassuming.\n\nThe Professor looks up at the structure once more, then back at Henri.\n\nPROFESSOR\n\nI am afraid that you are wrong. We are here to learn.\n\nHENRI\n\nTo learn what?\n\nPROFESSOR\n\nWell, we were talking.\n\nYoHanse looks at the Professor and gives him a hug.\n\nPROFESSOR\n\nWe would like to learn if you could fly.\n\n\n---\n\n\n### Scene 13: We Are Here to Learn\n\n*ACT II — The Outpost | ID: we-are-here-to-learn | File: 13_we_are_here_to_learn.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nFly?\n\nPROFESSOR\n\nFly.\n\nHENRI\n\nWell, I'll save you the trouble. I can't.\n\nPROFESSOR\n\nSays who?\n\nHENRI\n\nSays I, says physics, says reality.\n\n\n---\n\n\n### Scene 14: Fly\n\n*ACT II — The Outpost | ID: fly | File: 14_fly.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nPROFESSOR\n\nI don't understand you Henri, and I feel like withdrawing my praise of your navigating mind. Neither physics nor reality talk in a way that can be formed in a declarative statement—only you.\n\nThe wind picks up. The trees begin to flutter. YoHanse smiles at the leaves blowing in the warm air—and back at Henri, expecting.\n\nPROFESSOR\n\nOnly you have the determine if you can fly or not.\n\n\n---\n\n\n### Scene 15: Says Who?\n\n*ACT II — The Outpost | ID: says-who | File: 15_says_who.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nWell, if I could fly—what do you want me to get up there?\n\nPROFESSOR\n\nNot everything has to have a specific task Henri. Why not just fly for flying's sake? Do you breathe with a task in mind?\n\nPROFESSOR\n\nTry. Focus. Envision yourself lifting off the ground and reaching that top.\n\n\n---\n\n\n### Scene 16: Only You\n\n*ACT II — The Outpost | ID: only-you | File: 16_only_you.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nDo you know how to fly?\n\nPROFESSOR\n\nI don't—but we assumed that because you are from a different world, that perhaps you would have abilities that we Machulu people wouldn't.\n\nHENRI\n\nYou just gave me a soapbox sermon about how flying only resides if my will allows. If that's all it took—why don't you fly?\n\nPROFESSOR\n\nAye that's a good question. Well, truth revealed—we are here to learn. From you Henri. For we don't know how, but hope you do—and will teach us.\n\n\n---\n\n\n### Scene 17: Fly for Flying's Sake\n\n*ACT II — The Outpost | ID: fly-for-flyings-sake | File: 17_fly_for_flyings_sake.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nYoHanse speaks in Machulu.\n\nPROFESSOR\n\nYakka Leko Yingo—Si Yakka Leko Undra A VaVa A Penimo.\n\nPROFESSOR\n\nYes my boy, Yes.\n\nPROFESSOR\n\nHe says, if we could fly—we could head to the castle.\n\nThe Professor brushes some of YoHanse's purple hair away from his face and the dirt beneath his brow. He smiles at the boy. They both look presently at Henri.\n\n\n---\n\n\n### Scene 18: Head to the Castle\n\n*ACT II — The Outpost | ID: head-to-the-castle | File: 18_head_to_the_castle.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHENRI\n\nWell, I'm sorry but I can't.\n\nYoHanse speaks. The Professor translates.\n\nPROFESSOR\n\nTeko Ugga Mancho?\n\nPROFESSOR\n\nUgga Mancho.\n\nHenri stands there beneath the wooden pole like a fellow stepping on stage—knowing he has to sing but not knowing what to sing, or even a song in the remote part of his mind.\n\n\n---\n\n\n### Scene 19: Beneath the Pole\n\n*ACT II — The Outpost | ID: beneath-the-pole | File: 19_beneath_the_pole.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHenri takes a deep breath. He does everything he can to imagine what it would be like to fly up to that post.\n\nHe thinks of his hands floating, his feet floating, his body following suit. How his hands would act like anchors—or better yet, like rockets—and imagines what it would feel like to have his muscles follow suit.\n\nHe looks up at the post once more.\n\n\n---\n\n\n### Scene 20: The Attempt\n\n*ACT II — The Outpost | ID: the-attempt | File: 20_the_attempt.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nHenri takes a deep breath and attempts.\n\nMoments go by. Seconds go by. A minute. Two minutes.\n\nHENRI\n\nI don't know guys, I don't think I can.\n\nThe Professor looks at Henri, then back at YoHanse.\n\nPROFESSOR\n\nAye, okay Henri.\n\n\n---\n\n\n### Scene 21: Moments Pass\n\n*ACT II — The Outpost | ID: moments-pass | File: 21_moments_pass.md*\n\n---\n\nEXT. OUTPOST — DAY\n\nThe two begin to walk toward the thicket of the bush again.\n\nHenri is left behind—feeling as if he just denied the birthday boy his final wish before his death. Beating himself up in the process.\n\nNo, he tells himself. This is all absurd. Don't feel bad for these crazy folks. They don't know the laws of physics. They live in la la land.\n\nHenri, to himself: Lord, if you are there—get me out of this hell.\n\n\n---\n\n\n### Scene 22: Toward the Thicket\n\n*ACT II — The Outpost | ID: toward-the-thicket | File: 22_toward_the_thicket.md*\n\n---\n\nEXT. WOOD — DAY\n\nThe Professor and YoHanse walk toward the thicket. Henri follows, trailing.\n\nSuddenly—\n\nYOHANSE\n\nYaka!\n\nYoHanse lets out a scream. The wood is surrounded by glowing amber eyes.\n\n\n---\n\n\n## ACT III — The Creatures\n\n---\n\n\n### Scene 23: Yaka!\n\n*ACT III — The Creatures | ID: yaka | File: 23_yaka.md*\n\n---\n\nEXT. WOOD — DAY\n\nSuddenly YoHanse pops up. He sticks his chest out—surveying the field. He takes whiffs with his nose.\n\nYOHANSE\n\nTwenty five down the eastern end.\n\nThe air grows tense. Thick. The Professor walks over and pulls Henri behind a tree.\n\n\n---\n\n\n### Scene 24: Twenty Five Down\n\n*ACT III — The Creatures | ID: twenty-five-down | File: 24_twenty_five_down.md*\n\n---\n\nEXT. WOOD — HIDING\n\nThe Professor grabs Henri under his cloak and pulls him under the resting place. There they rest—in utter silence.\n\nYoHanse peers over and comes back with an expressionless face. It is like a different person. Never has Henri seen his face so emotionless. Suddenly his eyes begin to glow.\n\nSound creeps still, like a hawk in the valley—hoping and waiting for its prey.\n\n\n---\n\n\n### Scene 25: Under the Cloak\n\n*ACT III — The Creatures | ID: under-the-cloak | File: 25_under_the_cloak.md*\n\n---\n\nEXT. WOOD — HIDING\n\nHenri leans to the Professor—who has a shiny brass-colored instrument in his hand. He ignores the situation and is fixated on carefully turning the dial.\n\nA squawk is heard in the distance—not unlike a bird. Suddenly the echo of the noise reverberates onto the floor—until the small tiny particle effects feel like they are moving dirt in spiral directions.\n\nHenri has given these people his life. He has never felt—nor since then forward—so hopeless and out of control.\n\n\n---\n\n\n### Scene 26: YoHanse Peers\n\n*ACT III — The Creatures | ID: yo hanse-peers | File: 26_yohanse_peers.md*\n\n---\n\nEXT. WOOD — HIDING\n\nAs Henri studies the mechanics—something to take his mind off the present danger and the tension in the air—the dust spins in so many different directions.\n\nSpirals at first. But then it starts to turn more angular, geometrical almost. Like tiny 2D triangles slowly turning 3D, as if lifting off the page. Though there is no page—this is the dirt.\n\nEither the dirt itself is made out of a material Henri cannot fathom—or the fathom itself is too much of a material known to fathom. In other words, this is much too wild. Much too physics bending.\n\n\n---\n\n\n### Scene 27: Dust Spirals\n\n*ACT III — The Creatures | ID: dust-spirals | File: 27_dust_spirals.md*\n\n---\n\nEXT. WOOD — HIDING\n\nHenri looks over to YoHanse. Damn, he thinks. He shouldn't focus on this. To relax and panic is to focus on what he can control—and that, at this present moment of life, seems to be the way in which the dirt sways into triangles, building holographic structures.\n\nBOOM!\n\nYakka yakka—kiko—Ah!\n\n\n---\n\n\n### Scene 28: Amber Eyes\n\n*ACT III — The Creatures | ID: amber-eyes | File: 28_amber_eyes.md*\n\n---\n\nEXT. WOOD — NIGHT / AFTERMATH\n\nHenri only remembers their eyes. How unlike human they were. Creature-like—but by a creator who could never love the creature.\n\nCould they ever turn back? Are they too far gone from their original form—without hope? Do these creatures truly come from hatred—or are they results of decisions that left them in this horrid condition?\n\nThey were so angular—disturbing. Their arcs like mini bridges. Beneath the bridge, a moonlit baseball—slowing up and down, bouncing almost. Ping pong eyes.\n\nPROFESSOR\n\nAye! Do you know who we are? Do you know who has sent us into this wood? We demand to talk to an elder of this village.\n\nAn elder? Are these creatures civilized?\n\nPROFESSOR\n\nThis is a great time to fly.\n\nHENRI\n\nWhy did you even think I could fly in the first place? What gave you such an impression?\n\n\n---\n\n\n### Scene 29: Do You Know Who We Are?\n\n*ACT III — The Creatures | ID: do-you-know-who-we-are | File: 29_do_you_know_who_we_are.md*\n\n---\n\nEXT. WOOD — DAY\n\nYoHanse looks up and sees them swinging from tree top to tree top. These creatures have fantastic mobility.\n\nAs there are many, YoHanse with all of his might tries to focus on one—only one—of the unknown and unnamed creatures. He is able to do so. In almost slow motion, a creature makes a giant leap from off a tree branch into a crouched landing position. It then proceeds to spear up toward the branches and ceiling.\n\nYoHanse begins to run after this creature—who stole his bird statue.\n\n\n---\n\n\n## ACT IV — The Leap\n\n---\n\n\n### Scene 30: The Waterfall\n\n*ACT IV — The Leap | ID: the-waterfall | File: 30_the_waterfall.md*\n\n---\n\nEXT. WOOD — DAY\n\nYoHanse runs and runs through the thicket. He jumps over rivers and holes, fixated on the creature rapidly moving through the treelines.\n\nSuddenly a waterfall comes into focus. YoHanse stops. He turns around. The creature remains—panting, gasping for air—nestled high in a tree branch overlooking the waterfall.\n\nYoHanse calls out in Machulu: Spe Spe Ek Kah.\n\nThe creature remains perched on the tree branch in a crouched position. Slightly laughing. He takes from his leaf backpack—YoHanse's stone bird.\n\nYOHANSE\n\nNow you know that I cannot let you do that. What is it that you want? Quickly tell me now—I am in a bit of a hurry.\n\nCREATURE\n\nYou!\n\nThe creature's finger points at YoHanse. He signals for him to jump off the cliff.\n\nYoHanse jumps.\n\n\n---\n\n";
    const container = document.getElementById('scriptContent');
    marked.setOptions({ breaks: true });
    container.innerHTML = marked.parse(markdown);
    formatScreenplay(document.querySelector('.screenplay-container'));

    (function initScriptStatsAndProgress() {
      const WORDS_PER_PAGE = 250;
      const content = document.getElementById('scriptContent');
      const progressFill = document.getElementById('scriptProgressFill');
      const progressLabel = document.getElementById('scriptProgressLabel');
      const progressBar = document.querySelector('.script-progress-bar');
      if (!progressFill) return;
      const wordCount = (typeof markdown === 'string' ? markdown : (content && content.textContent) || '').split(/\s+/).filter(Boolean).length;
      const MIN_PAGES = 90;
      const rawPages = Math.round((wordCount / WORDS_PER_PAGE) * 10) / 10;
      const estimatedPages = Math.max(MIN_PAGES, rawPages);
      const estimatedMinutes = Math.max(MIN_PAGES, Math.round(estimatedPages));
      function updateProgress() {
        const docEl = document.documentElement;
        const scrollTop = docEl.scrollTop || document.body.scrollTop;
        const scrollHeight = docEl.scrollHeight - docEl.clientHeight;
        if (scrollHeight <= 0) {
          progressFill.style.width = '0%';
          progressLabel.textContent = 'Minute 0 of ' + estimatedMinutes;
          if (progressBar) progressBar.setAttribute('aria-valuenow', 0);
          return;
        }
        const pct = Math.min(1, Math.max(0, scrollTop / scrollHeight));
        const currentMinute = Math.min(estimatedMinutes, Math.floor(pct * estimatedMinutes));
        progressFill.style.width = (pct * 100) + '%';
        progressLabel.textContent = 'Minute ' + currentMinute + ' of ' + estimatedMinutes;
        if (progressBar) progressBar.setAttribute('aria-valuenow', Math.round(pct * 100));
      }
      updateProgress();
      window.addEventListener('scroll', updateProgress, { passive: true });
      window.addEventListener('resize', updateProgress);
    })();

    (function initSceneNav() {
      const content = document.getElementById('scriptContent');
      const selectEl = document.getElementById('scriptSceneSelect');
      if (!content || !selectEl) return;
      const sceneHeadings = content.querySelectorAll('h3');
      const sceneHeadingRe = /^Scene \d+:/i;
      sceneHeadings.forEach((h3, i) => {
        const text = (h3.textContent || '').trim();
        if (sceneHeadingRe.test(text)) h3.id = 'scene-' + (i + 1);
      });
      selectEl.addEventListener('change', function() {
        const value = this.value;
        if (!value) return;
        const el = document.getElementById(value);
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        this.value = '';
      });
    })();

    (function initStatusBar() {
      const content = document.getElementById('scriptContent');
      const sceneEl = document.getElementById('scriptStatusScene');
      const charsEl = document.getElementById('scriptStatusCharacters');
      const prodEl = document.getElementById('scriptStatusProduction');
      if (!content || !sceneEl) return;
      function getSceneHeadingsInOrder() {
        const h3s = content.querySelectorAll('h3[id^="scene-"]');
        return Array.from(h3s).sort((a, b) => {
          const nA = parseInt(a.id.replace('scene-', ''), 10);
          const nB = parseInt(b.id.replace('scene-', ''), 10);
          return nA - nB;
        });
      }
      function getSceneBlock(sceneH3, nextSceneH3) {
        const chars = new Set();
        let firstSlug = '';
        let node = sceneH3.nextSibling;
        while (node) {
          if (node === nextSceneH3) break;
          if (node.nodeType === 1) {
            if (node.classList && node.classList.contains('character-name')) {
              const name = (node.textContent || '').trim();
              if (name) chars.add(name);
            }
            if (!firstSlug && node.classList && node.classList.contains('scene-heading')) firstSlug = (node.textContent || '').trim();
          }
          node = node.nextSibling;
        }
        return { characters: Array.from(chars), production: firstSlug };
      }
      function updateStatusBar() {
        const sceneHeadings = getSceneHeadingsInOrder();
        if (sceneHeadings.length === 0) return;
        const viewportThreshold = 160;
        let current = sceneHeadings[0];
        for (let i = 0; i < sceneHeadings.length; i++) {
          const top = sceneHeadings[i].getBoundingClientRect().top;
          if (top <= viewportThreshold) current = sceneHeadings[i];
        }
        const title = (current.textContent || '').trim();
        const nextId = current.id.replace('scene-', '');
        const nextNum = parseInt(nextId, 10) + 1;
        const nextScene = document.getElementById('scene-' + nextNum);
        const block = getSceneBlock(current, nextScene || null);
        sceneEl.textContent = title || '—';
        charsEl.textContent = block.characters.length ? block.characters.join(', ') : '—';
        prodEl.textContent = block.production || '—';
      }
      updateStatusBar();
      window.addEventListener('scroll', updateStatusBar, { passive: true });
      window.addEventListener('resize', updateStatusBar);
    })();

    function formatScreenplay(container) {
      const content = container.querySelector('.screenplay-content');
      if (!content) return;
      function normalizeParagraphBreaks(content) {
        const paragraphs = Array.from(content.querySelectorAll('p'));
        paragraphs.forEach((p) => {
          if (!p.querySelector('br')) return;
          const parts = p.innerHTML.split(/<br\s*\/?\s*>/i).map((s) => s.replace(/&nbsp;/g, ' ').trim()).filter(Boolean);
          if (parts.length <= 1) return;
          const frag = document.createDocumentFragment();
          parts.forEach((html) => {
            const np = document.createElement('p');
            np.innerHTML = html;
            frag.appendChild(np);
          });
          p.replaceWith(frag);
        });
      }
      normalizeParagraphBreaks(content);
      const paragraphs = content.querySelectorAll('p');
      let inDialogueBlock = false;
      paragraphs.forEach((p, index) => {
        const text = p.textContent.trim();
        const nextP = paragraphs[index + 1];
        const prevP = paragraphs[index - 1];
        if (!text) return;
        if (p.classList.length > 0 && !p.classList.contains('line-split')) return;
        if (/^(INT\.|EXT\.)/i.test(text)) { p.className = 'scene-heading'; p.textContent = text.toUpperCase(); inDialogueBlock = false; return; }
        if (/^(FADE IN|FADE OUT|CUT TO|DISSOLVE TO|SMASH CUT|MATCH CUT)/i.test(text)) { p.className = 'transition'; p.textContent = text.toUpperCase(); inDialogueBlock = false; return; }
        if (/^\(.+\)$/.test(text)) { p.className = 'parenthetical'; inDialogueBlock = true; return; }
        const isAllCaps = /^[A-Z][A-Z\s\.'-]+$/.test(text) && text === text.toUpperCase();
        const isReasonableLength = text.length > 2 && text.length < 35;
        const isNotSceneHeading = !/^(INT\\.|EXT\\.|FADE|CUT|DISSOLVE)/i.test(text);
        if (isAllCaps && isReasonableLength && isNotSceneHeading) {
          const nextText = nextP ? nextP.textContent.trim() : '';
          const looksLikeDialogue = nextText && (/^\(.+\)$/.test(nextText) || (!/^(INT\.|EXT\.|FADE|CUT|DISSOLVE)/i.test(nextText) && !/^[A-Z][A-Z\s\.'-]+$/.test(nextText)));
          if (looksLikeDialogue || !prevP || prevP.classList.contains('action-line') || prevP.classList.contains('scene-heading')) {
            p.className = 'character-name';
            inDialogueBlock = true;
            return;
          }
        }
        const looksLikeNewBlock = /^(INT\.|EXT\.|FADE IN|FADE OUT|CUT TO|DISSOLVE TO|SMASH CUT|MATCH CUT)/i.test(text);
        const looksLikeCharacter = isAllCaps && isReasonableLength && isNotSceneHeading;
        if (!looksLikeNewBlock && inDialogueBlock && prevP && (prevP.classList.contains('character-name') || prevP.classList.contains('parenthetical') || prevP.classList.contains('dialogue'))) {
          p.className = 'dialogue';
          inDialogueBlock = true;
          return;
        }
        if (looksLikeCharacter || looksLikeNewBlock) inDialogueBlock = false;
        p.className = 'action-line';
        inDialogueBlock = false;
      });
      const ps = content.querySelectorAll('p');
      ps.forEach((p, i) => {
        if (!p.classList.contains('dialogue') && !p.classList.contains('parenthetical')) return;
        const next = ps[i + 1];
        if (!next || (!next.classList.contains('dialogue') && !next.classList.contains('parenthetical'))) {
          if (p.classList.contains('dialogue')) p.classList.add('dialogue-last');
          if (p.classList.contains('parenthetical')) p.classList.add('parenthetical-last');
        }
      });
    }
  </script>
</body>
</html>